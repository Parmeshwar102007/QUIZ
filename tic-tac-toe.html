<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe (Moderate AI)</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .board { display: grid; grid-template-columns: repeat(3, 100px); grid-gap: 5px; margin: 20px auto; width: 310px; }
        .cell { width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; font-size: 2em; background: #ddd; cursor: pointer; }
        .cell.taken { background: #bbb; cursor: not-allowed; }
        .win { background: lightgreen !important; } /* Highlight winning cells */
        button { margin: 10px; padding: 10px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

<h2>Tic-Tac-Toe (Moderate AI)</h2>
<div class="board" id="board"></div>
<p id="status"></p>
<p>Wins: <span id="wins">0</span> | Losses: <span id="losses">0</span> | Ties: <span id="ties">0</span></p>
<button onclick="resetGame()">Restart Game</button>
<button onclick="undoMove()">Undo Move</button>

<script>
    const board = document.getElementById("board");
    const status = document.getElementById("status");
    let gameBoard = ["", "", "", "", "", "", "", "", ""];
    let currentPlayer = "X"; // Player is X, AI is O
    let gameActive = true;
    let moveHistory = []; // Stores previous moves
    let wins = 0, losses = 0, ties = 0; // Track stats

    function createBoard() {
        board.innerHTML = "";
        gameBoard.forEach((cell, index) => {
            const cellElement = document.createElement("div");
            cellElement.classList.add("cell");
            cellElement.textContent = cell;
            if (cell) cellElement.classList.add("taken");
            cellElement.addEventListener("click", () => playerMove(index));
            board.appendChild(cellElement);
        });
    }

    function playerMove(index) {
        if (!gameActive || gameBoard[index]) return;
        gameBoard[index] = "X";
        moveHistory.push(index); // Save move history
        checkGameStatus();
        if (gameActive) {
            status.textContent = "AI Thinking...";
            setTimeout(aiMove, 500);
        }
    }

    function aiMove() {
        let bestMove = getModerateMove();
        if (bestMove !== -1) {
            gameBoard[bestMove] = "O";
            moveHistory.push(bestMove);
            checkGameStatus();
        }
    }

    function getModerateMove() {
        let availableMoves = gameBoard.map((val, index) => (val === "" ? index : null)).filter(val => val !== null);

        if (Math.random() < 0.6) { 
            return getBestMove(); // 60% chance to play smart
        } else {
            return availableMoves[Math.floor(Math.random() * availableMoves.length)]; // 40% chance to play randomly
        }
    }

    function getBestMove() {
        let bestScore = -Infinity;
        let move = -1;
        gameBoard.forEach((cell, index) => {
            if (cell === "") {
                gameBoard[index] = "O";
                let score = minimax(gameBoard, 0, false);
                gameBoard[index] = "";
                if (score > bestScore) {
                    bestScore = score;
                    move = index;
                }
            }
        });
        return move;
    }

    function minimax(board, depth, isMaximizing) {
        let scores = { X: -10, O: 10, tie: 0 };
        let winner = checkWinner();
        if (winner) return scores[winner];

        if (isMaximizing) {
            let bestScore = -Infinity;
            board.forEach((cell, index) => {
                if (cell === "") {
                    board[index] = "O";
                    let score = minimax(board, depth + 1, false);
                    board[index] = "";
                    bestScore = Math.max(score, bestScore);
                }
            });
            return bestScore;
        } else {
            let bestScore = Infinity;
            board.forEach((cell, index) => {
                if (cell === "") {
                    board[index] = "X";
                    let score = minimax(board, depth + 1, true);
                    board[index] = "";
                    bestScore = Math.min(score, bestScore);
                }
            });
            return bestScore;
        }
    }

    function checkGameStatus() {
        let winner = checkWinner();
        if (winner) {
            gameActive = false;
            if (winner === "X") {
                status.textContent = "You Win!";
                wins++;
            } else if (winner === "O") {
                status.textContent = "AI Wins!";
                losses++;
            } else {
                status.textContent = "It's a Tie!";
                ties++;
            }
            document.getElementById("wins").textContent = wins;
            document.getElementById("losses").textContent = losses;
            document.getElementById("ties").textContent = ties;
        }
        createBoard();
    }

    function checkWinner() {
        const winPatterns = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], 
            [0, 3, 6], [1, 4, 7], [2, 5, 8], 
            [0, 4, 8], [2, 4, 6]
        ];
        for (let pattern of winPatterns) {
            let [a, b, c] = pattern;
            if (gameBoard[a] && gameBoard[a] === gameBoard[b] && gameBoard[a] === gameBoard[c]) {
                highlightWin(pattern);
                return gameBoard[a];
            }
        }
        if (!gameBoard.includes("")) return "tie";
        return null;
    }

    function highlightWin(pattern) {
        pattern.forEach(index => {
            board.children[index].classList.add("win");
        });
    }

    function resetGame() {
        gameBoard = ["", "", "", "", "", "", "", "", ""];
        gameActive = true;
        moveHistory = [];
        status.textContent = "";
        createBoard();
    }

    function undoMove() {
        if (moveHistory.length >= 2) {
            let lastMove = moveHistory.pop();
            gameBoard[lastMove] = "";
            let aiMove = moveHistory.pop();
            if (aiMove !== undefined) gameBoard[aiMove] = "";
            gameActive = true;
            status.textContent = "Move undone!";
            createBoard();
        }
    }

    createBoard();
</script>

</body>
</html>